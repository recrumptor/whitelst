name: Daily Domain List Update

on:
  schedule:
    # Запуск каждый день в 00:00 UTC
    - cron: '0 0 * * *'
  workflow_dispatch: # Позволяет запустить процесс вручную кнопкой в GitHub
  
permissions:
  contents: write
  
jobs:
  update-list:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download and Format Lists
        run: |
          declare -A FILES=(
            ["geo"]="https://raw.githubusercontent.com/itdoginfo/allow-domains/refs/heads/main/Categories/geoblock.lst"
            ["GoogleAI"]="https://raw.githubusercontent.com/itdoginfo/allow-domains/refs/heads/main/Services/google_ai.lst"
            ["Youtube"]="https://raw.githubusercontent.com/itdoginfo/allow-domains/refs/heads/main/Services/youtube.lst"
            ["google_play"]="https://raw.githubusercontent.com/itdoginfo/allow-domains/refs/heads/main/Services/google_play.lst"
            ["block"]="https://raw.githubusercontent.com/itdoginfo/allow-domains/refs/heads/main/Categories/block.lst"
            ["telegram"]="https://raw.githubusercontent.com/itdoginfo/allow-domains/refs/heads/main/Services/telegram.lst"
          )

          for NAME in "${!FILES[@]}"; do
            URL="${FILES[$NAME]}"
            TMP="raw_${NAME}.txt"
            OUT="${NAME}.txt"

            echo "Processing $NAME from $URL"

            curl -sSL "$URL" -o "$TMP"
            sed -E 's/^([a-zA-Z0-9])/\+\.\1/' "$TMP" > "$OUT"
            rm "$TMP"
          done


      - name: Commit and Push
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add .
          git commit -m "Daily update: $(date +'%Y-%m-%d')" || exit 0
          git push
